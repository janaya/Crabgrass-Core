-#
-# requires:
-# create_url -- url to send the action to
-# options:
-# last_id -- set in_reply_to_id, which currently is just used for helping
-# to generate the activity feed.
-# remote -- if not nil, generate an ajax form.
-#

- remote = local_assigns[:remote] || false
- form = remote ? method(:remote_form_for) : method(:form_for)
- form_options = {:url => create_url, :loading => show_spinner('post')}
%td.post_author
  = author_selection_tag('user_id', @group || @user || @context.try(:entity))
%td.post_body
  - form.call(:post, @post, form_options) do |f|
    = hidden_field_tag('post[user_id]', '', :id => 'user_id')
    = f.text_area :body, :rows => 8, :class => 'input-xlarge'
    .buttons
      .float_left= formatting_reference_link
      - if remote
        = spinner('post')
      = submit_tag :post_message.t, :name => 'post_message', :class => 'btn btn-primary'
